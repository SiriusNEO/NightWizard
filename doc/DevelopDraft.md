# CPU

## Intro

只是用来碎碎念的一个杂记，这样能理清我的思路，~~同时带来一点点成就感~~。

之前大概写了两周（其实主要都在配环境+摸索），就不记录了。



## 11.1

星期一。毛概课上陆陆续续写了一些，回来继续写。

大概把整体写完了。目前存在的问题：

- fetch 时间问题
- fetch 到第三个就终止了？疑似是 buffered 没搞好。

同时安装了一下 vivado，试了一下波形图。感觉没有 wavetrace 好用，于是换回。



## 11.2

重构，理清数据流，时序、组合。

还是有一些问题qwq 先写实验报告吧



## 11.3

解决了 RS 里存放 rob_id 没有多开一位的问题（都是这个写法害的）

~~现在 ROB 会满了 把 fetcher 停了 qaq~~（解决了，控制 store 发一次）

~~好像 load 还是有点问题~~ 没问题

~~以及莫名奇妙有 X 阻塞 裂开了~~ 位数不对（阻塞基本都是这个问题）

注意：

- SIZE 与 LEN 不要混用
- ROB 注意 +- 1 的问题

~~计划把指令跳转写掉~~ 写了

修了个 write 的 bug，多等了一个周期

好消息，好消息：现在能跑通最简单的程序了！

然而算术就炸了，乐

先写科算作业



## 11.4

经排查好像是跳转出错了

为什么禁止修改0寄存器程序就会执行错误？解决了 打错了

傻逼错误：长度开错了，现在可以输出多个了

~~BLTZ 有问题~~ 草 原来是 B imm 写错了

gcd 过了！~~但是 array 爆了不知道为什么~~

array 过了一点 还是 `ROB_LEN +-1 的问题。。。

可能要进行 size 大排查了

我超 有几根线忘记连了 斐波那契能跑了

输入炸了（？不确定原因，好像是我不知道怎么读入，不知道是不是我的问题）

又过了几个点



## 11.8

出去旅游，咕了一段时间，回来继续整

一个死循环bug：主要是 lsb commit 重复更新了，导致 store 不用先 commit 就直接提交了

分治的代码有问题：SLLI、SRLI、SRAI 三个 imm 需要取 shamt 部分！

大概 simulation 算 A 掉了，本周大物复习，下周拿板玩玩



## 11.13

这周事情忙完了 上了 icache

改掉了 Dispatcher 需要两个周期的设计

icache 会卡死 qaq



## 11.14

LSBuffer 出大问题 修了一通，现在可以跑通一些情况

连输出大数都不行了（

LS_EX 问题 怎么解决呢：修了，busy 命令延后，LS_EX 的 busy 信号加个 ena 判断

还是有问题，今天不调了

~~几把 怎么 101029 写入的是 49 ？？？？？？-> a0=1？~~ Dispatcher 没有用 ROB 更新！



## 11.15

乐 死循环

~~1080 bne s3, a5, 1070，a5？不对 好像是做太快了 a0 = 155178？？？~~ 看错了

LSBuffer 跳转问题：commit 更新问题

修好了！ROB busy 问题，但是 expr 为啥输出一个 +？？sort 死循环

105c:  01c88833       add a6,a7,t3

1068:  00f887b3       add a5,a7,a5   V2（28）

ROB 满 没处理好！（还是没处理好，但是解决了一些问题）

现在的问题好像只有 ROB 满了



## 11.17

上板成功（最近属于是精力全被这玩意儿夺走了）

但是还有一些奇怪问题

注意 vivado 和 iverlog 之间的差异！消除 latch！

降低 WNS 思路确定中



## 11.18

input 数据点 wrong answer，sleep 正常，uart 未解决，其它工作正常

icache 大小会影响 magic

regfile 延迟过大